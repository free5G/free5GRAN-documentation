<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>free5GRAN: synchronization.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">free5GRAN
   &#160;<span id="projectnumber">V1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('synchronization_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">synchronization.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="synchronization_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Time and frequency synchronization</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;## Time domain synchronization:</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Time domain synchronization is based on PSS and SSS correlation. Those two physical signals are part of Synchronization Signal Block (SSB), which also comprises PBCH and PBCH DMRS. PSS and SSS are generated based on `N_ID_2` and `N_ID_1`. Time domain synchronization consists in cross correlating all possible PSS sequences with received frame. Highest correlation peak gives $N_{ID}^{(2)}$ and the time where input signal contains PSS, which provides time synchronization. SSS sequences are then correlated with received signal to deduce `N_ID_1` and receiver can compute Physical Cell ID, written `N_ID_CELL`:</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;```</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;N_ID_CELL = 3 . N_ID_1 + N_ID_2</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;```</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;In the current implementation, PSS synchronization is done in `src/phy/phy.cpp` line `111`:</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;```</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;free5GRAN::phy::synchronization::search_pss(n_id_2,synchronisation_index,peak_value, common_cp_length, buff, fft_size);</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;```</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;And SSS correlation is done after having isolated the corresponding part of the signal:</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;```$xslt</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;free5GRAN::phy::synchronization::get_sss(n_id_1, peak_value_sss, sss_signal, fft_size, n_id_2);</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;```</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;In the current version, cell time-wise synchronization is done twice. In a first step, the receiver tries to search if a cell exists, and scan the frequency with the lowest possible bandwidth. In a second step, receiver increases its bandwidth and re-synchronizes with the cell. While resynchronizing, receiver first downsample the signal so the PSS search is much quicker:</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;```$xslt</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;vector&lt;complex&lt;float&gt;&gt; pss_signal_downsampled(48 * symbol_duration_downsampled);</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;for (int i = 0; i &lt; 48 * symbol_duration_downsampled; i ++){</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    pss_signal_downsampled[i] = pss_signal[downsampling_factor * i];</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;}</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;```</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;## Frequency domain synchronization:</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;Fine frequency synchronization has to be performed to mitigate Doppler effects. First, SSB symbols cyclic prefixes are correlated with corresponding symbols part. Phase offset on each symbol is derived as being the phase of the previous correlation. Finally, global phase offset is computed as being the mean of symbols phase offsets, and frequency correction is computed.</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;In the current implementation, this is done in `src/phy/phy.cpp` line `346`:</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;```$xslt</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;free5GRAN::phy::signal_processing::compute_fine_frequency_offset(ssb_signal, symbol_duration, fft_size, common_cp_length, scs, freq_offset, free5GRAN::NUM_SYMBOLS_SSB);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;```</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="synchronization_8md.html">synchronization.md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
